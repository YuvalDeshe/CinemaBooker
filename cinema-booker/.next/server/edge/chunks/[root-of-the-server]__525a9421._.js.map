{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/cinema-booker/src/middleware.ts"],"sourcesContent":["// src/middleware.ts\nimport { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { getToken } from \"next-auth/jwt\";\n\nexport async function middleware(req: NextRequest) {\n  const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n  const { pathname } = req.nextUrl;\n\n  const publicPaths = [\"/\", \"/login\", \"/register\", \"/api/verify-email\"];\n  \n  const movieBrowsingPaths = [\"/movie\"]; // Allow viewing movies and showtimes\n  \n  const authRequiredPaths = [\"/user\", \"/profile\"];\n  \n  const verificationRequiredPaths = [\"/booking\"]; // Only booking requires verification\n  \n  const unauthenticatedPaths = [\"/login\", \"/register\"];\n\n  const isAuthenticated = !!token;\n  const isEmailVerified = token?.isEmailVerified ?? false;\n\n   if (\n    pathname.startsWith(\"/_next\") ||            \n    pathname.startsWith(\"/api/auth\") ||         \n    pathname.startsWith(\"/posters/\") ||         \n    pathname === \"/favicon.ico\" ||\n    pathname === \"/robots.txt\" ||\n    pathname === \"/sitemap.xml\" ||\n    /\\.(png|jpg|jpeg|gif|svg|webp|ico|txt|map)$/i.test(pathname)\n  ) {\n    return NextResponse.next();\n  }\n\n  console.log(\"isAuthenticated:\", isAuthenticated, \"isEmailVerified:\", isEmailVerified, \"| path:\", pathname);\n\n  if (publicPaths.includes(pathname)) {\n    return NextResponse.next();\n  }\n\n  if (movieBrowsingPaths.some(path => pathname.startsWith(path))) {\n    return NextResponse.next();\n  }\n\n  if (isAuthenticated && unauthenticatedPaths.includes(pathname)) {\n    console.log(`Authenticated user attempted to access login/register page: '${pathname}'`)\n    return NextResponse.redirect(new URL(\"/\", req.url));\n  }\n\n  if (!isAuthenticated && authRequiredPaths.some(path => pathname.startsWith(path))) {\n    console.log(`Unauthenticated user attempted to access auth-required page: '${pathname}'`)\n    return NextResponse.redirect(new URL(\"/login\", req.url));\n  }\n\n  if (!isAuthenticated && verificationRequiredPaths.some(path => pathname.startsWith(path))) {\n    console.log(`Unauthenticated user attempted to access booking: '${pathname}'`)\n    return NextResponse.redirect(new URL(\"/login\", req.url));\n  }\n\n  if (isAuthenticated && !isEmailVerified && verificationRequiredPaths.some(path => pathname.startsWith(path))) {\n    console.log(`Unverified user attempted to access booking: '${pathname}'`);\n    return NextResponse.redirect(new URL(\"/?verification-required=true\", req.url));\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\"/((?!_next|api|static|favicon.ico).*)\"],\n};\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;;;AACpB;AAAA;AAEA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,QAAQ,MAAM,IAAA,oLAAQ,EAAC;QAAE;QAAK,QAAQ,QAAQ,GAAG,CAAC,eAAe;IAAC;IACxE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,MAAM,cAAc;QAAC;QAAK;QAAU;QAAa;KAAoB;IAErE,MAAM,qBAAqB;QAAC;KAAS,EAAE,qCAAqC;IAE5E,MAAM,oBAAoB;QAAC;QAAS;KAAW;IAE/C,MAAM,4BAA4B;QAAC;KAAW,EAAE,qCAAqC;IAErF,MAAM,uBAAuB;QAAC;QAAU;KAAY;IAEpD,MAAM,kBAAkB,CAAC,CAAC;IAC1B,MAAM,kBAAkB,OAAO,mBAAmB;IAEjD,IACC,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,UAAU,CAAC,gBACpB,aAAa,kBACb,aAAa,iBACb,aAAa,kBACb,8CAA8C,IAAI,CAAC,WACnD;QACA,OAAO,oNAAY,CAAC,IAAI;IAC1B;IAEA,QAAQ,GAAG,CAAC,oBAAoB,iBAAiB,oBAAoB,iBAAiB,WAAW;IAEjG,IAAI,YAAY,QAAQ,CAAC,WAAW;QAClC,OAAO,oNAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,mBAAmB,IAAI,CAAC,CAAA,OAAQ,SAAS,UAAU,CAAC,QAAQ;QAC9D,OAAO,oNAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,mBAAmB,qBAAqB,QAAQ,CAAC,WAAW;QAC9D,QAAQ,GAAG,CAAC,CAAC,6DAA6D,EAAE,SAAS,CAAC,CAAC;QACvF,OAAO,oNAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;IACnD;IAEA,IAAI,CAAC,mBAAmB,kBAAkB,IAAI,CAAC,CAAA,OAAQ,SAAS,UAAU,CAAC,QAAQ;QACjF,QAAQ,GAAG,CAAC,CAAC,8DAA8D,EAAE,SAAS,CAAC,CAAC;QACxF,OAAO,oNAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,IAAI,CAAC,mBAAmB,0BAA0B,IAAI,CAAC,CAAA,OAAQ,SAAS,UAAU,CAAC,QAAQ;QACzF,QAAQ,GAAG,CAAC,CAAC,mDAAmD,EAAE,SAAS,CAAC,CAAC;QAC7E,OAAO,oNAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,IAAI,mBAAmB,CAAC,mBAAmB,0BAA0B,IAAI,CAAC,CAAA,OAAQ,SAAS,UAAU,CAAC,QAAQ;QAC5G,QAAQ,GAAG,CAAC,CAAC,8CAA8C,EAAE,SAAS,CAAC,CAAC;QACxE,OAAO,oNAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gCAAgC,IAAI,GAAG;IAC9E;IAEA,OAAO,oNAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAwC;AACpD"}}]
}